<!DOCTYPE html>
<html>
    <head>
        <title>version</title>
	<meta charset=UTF-8" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="version.css"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js" charset="utf-8"></script>
        <script type="text/javascript" src="turnjs4/lib/turn.min.js"></script>
    </head>
    <body>
	<div id="haut">
            <h1>Esseyez nos porte-menu !</h1>
            <h2>Sélectionnez les options qui vous conviennent et tournez les pages.</h2>
        </div>
	<div id="option">
	    <span>Réglages :</span>
	    <select id="selectMenu">
		<option enabled>Choix du modèle</option>
		<option>MenuBook</option>
		<option>MenuSerigrafik</option>
		<option>MenuPlastik</option>
		<option>MenuBasik</option>
		<option>MenuClassik</option>
	    </select>
	    <select id="selectFormat">
		<option enabled>Format du menu</option>
		<optgroup label="Classiques :">
		    <option>A4</option>
		    <option>A5</option>
		    <option>A6</option>
		    <option>Cocktail</option>
		    <option>MiniCocktail</option>
		    <option>Carré</option>
		</optgroup>
		<optgroup label="Spéciales :">
		    <option>Grand</option>
		</optgroup>
	    </select>
	    <select id="selectCouleur">
		<option enabled>Couleur de fond</option>
		<option>Blanc</option>
		<option>Marron</option>
		<option>Noir</option>
		<option>Gris</option>
	    </select>
	    <select id="selectBordure">
		<option enabled>Couleur des bordures</option>
		<option value="Vert_fonce">Vert foncé</option>
		<option value="Vert_anis">Vert anis</option>
		<option value="Bleu_gris">Bleu gris</option>
		<option value="Bleu_fonce">Bleu foncé</option>
		<option value="Bleu_clair">Bleu clair</option>
		<option value="Jaune">Jaune</option>
		<option value="Orange">Orange</option>
		<option value="Rouge">Rouge</option>
		<option value="Bordeaux">Bordeaux</option>
		<option value="Violet">Violet</option>
		<option value="Creme">Crème</option>
		<option value="Marron">Marron</option>
		<option value="Noir">Noir</option>
		<option value="Gris">Gris</option>
		<option value="Rose">Rose</option>
		<option value="Blanc">Blanc</option>
	    </select>
	    <button id="pagePlus">+</button><button id="pageMoins">-</button>
	</div>
	<div id="container">
	    <div id="leMenu">
		<div id="flipbook">
		    <div class="hard"></div>
		    <div class="hard"></div>
		    <div class="page"><div class="innerpage bordure_Blanc fond_Blanc">Page 1 </div></div>
		    <div class="page"><div class="innerpage bordure_Blanc fond_Blanc">Page 2 </div></div>
		    <div class="page"><div class="innerpage bordure_Blanc fond_Blanc">Page 3 </div></div>
		    <div class="page"><div class="innerpage bordure_Blanc fond_Blanc">Page 4 </div></div>
		    <div class="hard"></div>
		    <div class="hard"></div>
		</div>
	    </div>
	    <div id="exemple">
		<h2>Exemple de menu :</h2>
		<img id="lesImg" src="menu1.jpg">
	    </div>
	</div>
    </body>
    <script>
	$("#flipbook").turn({ width: 800, height: 600 });
	
        $("#selectMenu").change(function() {    choixMenu(); });
        $("#selectFormat").change(function() {  formatMenu(); });
        $("#selectCouleur").change(function() { choixCouleurDeFond(); });
        $("#selectBordure").change(function() { choixCouleurBordure(); });
	
        // Macro qui renvoit un objet page
        function nouvellePage(numPage) {
            return $("<div />").append($("<div />", {"class": "innerpage fond_"+couleurFondActuelle+" bordure_"+couleurBordureActuelle }).html("Page "+numPage));
        }
	
        // Macro qui renvoit une couverture (classe passée en param)
        function nouvelleCouv(typeCouv) {
	    if (typeCouv == "") {
		return $("<div />", {"class": typeCouv}).append($("<div />", {"class": "innerpage fond_"+couleurFondActuelle+" bordure_"+couleurBordureActuelle }));
	    }
            return $("<div />", {"class": typeCouv});
        }
	
	function nouvelleHardInnerPage(typeCouv) {
	    return $("<div />", {"class": typeCouv}).append($("<div />", {"class": "innerpage fond_"+couleurFondActuelle+" bordure_"+couleurBordureActuelle }));
	}
	
        var nbMax = 16;
        var nbMin = 4;
        var nbPages = $("#flipbook").turn("pages"); // Nb de pages actuelles du flipbook (dont 4 de couvertures)
	
        $("#pagePlus").click(function() {
            if (nbPages < nbMax) {
                console.log("Ajout page");
                $("#flipbook").turn("pages", nbPages+2);    // On dit qu'on va ajouter 2 pages
                $("#flipbook").turn("addPage", nouvellePage(nbPages-3), nbPages-1); // on ajoute le recto
                $("#flipbook").turn("addPage", nouvellePage(nbPages-2), nbPages);   // et le verso
                nbPages += 2;   // On incrémente le compteur de pages réelles
            }
        });
	
        $("#pageMoins").click(function() {
            if (nbPages > nbMin) {
                console.log("Suppr page");
                $("#flipbook").turn("removePage", nbPages-2); // on enlève le recto
                $("#flipbook").turn("removePage", nbPages-3); // et le verso
                $("#flipbook").turn("pages", nbPages-2);      // On dit qu'on a enlevé 2 pages
                nbPages -= 2;   // On décrémente le compteur de pages réelles
            }
        });
	
        function switchTo(type) {
            // Suppr. couv de devant
            $("#flipbook").turn("removePage", 2);       // on enlève le verso
            $("#flipbook").turn("removePage", 1);       // et le recto
            $("#flipbook").turn("pages", nbPages-2);    // On dit qu'on a enlevé 2 pages
            nbPages -= 2;                               // compteur de pages réelles
            // Suppr. couv de derriere
            $("#flipbook").turn("pages", nbPages-2);    // On dit qu'on a enlevé 2 pages (supprime les 2 dernières pages en trop)
            nbPages -= 2;                               // compteur de pages réelles
	    
            // Nouvelle couv devant
            $("#flipbook").turn("pages", nbPages+2);    // On dit qu'on va ajouter 2 pages
            $("#flipbook").turn("addPage", nouvelleCouv(type), 1);
            $("#flipbook").turn("addPage", nouvelleHardInnerPage(type), 2);
            nbPages += 2;                               // compteur de pages réelles
            // Nouvelle couv derriere
            $("#flipbook").turn("pages", nbPages+2);    // On dit qu'on va ajouter 2 pages
            $("#flipbook").turn("addPage", nouvelleHardInnerPage(type), nbPages+1);
            $("#flipbook").turn("addPage", nouvelleCouv(type), nbPages+2);
            nbPages += 2;                               // compteur de pages réelles
        }
	
	function addFond() {
	    console.log('fondSerigrafik');
	    $("#selectCouleur").append($('<option>', { value: 'Orange', text: 'Orange' }));
	    $("#selectCouleur").append($('<option>', { value: 'Rouge', text: 'Rouge' }));
	    $("#selectCouleur").append($('<option>', { value: 'Crème', text: 'Crème' }));
	}
	
	function fondNormal() {
	    console.log('fondNormal');
	    $("#selectCouleur option[value='Orange']").remove();
	    $("#selectCouleur option[value='Rouge']").remove();
	    $("#selectCouleur option[value='Crème']").remove();
	}
	
         function choixMenu() {
             switch ($("#selectMenu option:selected").text()) {
                    case "MenuBasik":
                        switchTo('');
			fondNormal();
                        break;
                    case "MenuPlastik":
			switchTo('hard');
			fondNormal();
			break;
                    case "MenuSerigrafik":
			switchTo('hard');
			addFond();
			switchTo('serigrafik');
			break;
                    case "MenuClassik":
			switchTo('hard');
			fondNormal();
			break;
                    case "MenuBook":
                        switchTo('hard');
			fondNormal();
                        break;
            }
        }
	
        function formatMenu() {
            switch ($("#selectFormat option:selected").text()) {
                case "A4":
                    $("#flipbook").turn("size", 793, 600);
                    break;
                case "A5":
                    $("#flipbook").turn("size", 600, 500);
                    break;
                case "A6":
                    $("#flipbook").turn("size",500, 400);
                    break;
                case "Cocktail":
                    $("#flipbook").turn("size", 650, 600);
                    break;
                case "MiniCocktail":
                    $("#flipbook").turn("size", 450, 400);
                    break;
                case "Carré":
                    $("#flipbook").turn("size", 800, 400);
                    break;
                case "Grand":
                    $("#flipbook").turn("size", 850, 700);
                    break;
            }
        }
	
        var couleurFondActuelle = 'Blanc';
        function choixCouleurDeFond() {
            $("#flipbook").turn("resize");
            $(".page .innerpage, .page").removeClass( "fond_" + couleurFondActuelle);
            var couleur = $("#selectCouleur option:selected").text();
            console.log("Choix de fond " + couleur);
            $(".page .innerpage, .page").addClass( "fond_" + couleur);
            couleurFondActuelle = couleur;
        }
	
        var couleurBordureActuelle = 'Blanc';
        function choixCouleurBordure() {
            $(".innerpage").removeClass( "bordure_" + couleurBordureActuelle );
	    
            var couleur = $("#selectBordure option:selected").val();
            console.log("Choix de bordure " + couleur);
	    
            $(".innerpage").addClass( "bordure_" + couleur );
            couleurBordureActuelle = couleur;
        }
	
        $("#flipbook").bind("start",
            function(event, page, obj){
                $("div[class*=' fond_']:not(.fond_"+couleurFondActuelle+")") // Tous les div qui ont une classe fond_* mais pas la bonne
                    .removeClass (function (index, css) {
                        return (css.match (/(^|\s)fond_\S+/g) || []).join(' ');
                    })
                    .addClass( "fond_" + couleurFondActuelle );
			
                $("div[class*=' bordure_']:not(.bordure_"+couleurBordureActuelle+")") // Tous les div qui ont une classe bordure_* mais pas la bonne
                    .removeClass (function (index, css) {
                        return (css.match (/(^|\s)bordure_\S+/g) || []).join(' ');
                    })
                    .addClass( "bordure_" + couleurBordureActuelle );
            });
	
	$("#lesImg").click(function() {
	    console.log("exemple menu");
	    
	});
	
    </script>
</html>













